#!/usr/bin/env bash

# Run commitlint first
npx --no -- commitlint --edit "$1"

# Then add emoji (keeping existing functionality)
commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# çµµæ–‡å­—ãƒžãƒƒãƒ”ãƒ³ã‚°
add_emoji() {
    local message="$1"
    
    # çµµæ–‡å­—ãŒã™ã§ã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆç°¡æ˜“ãƒã‚§ãƒƒã‚¯ï¼‰
    if echo "$message" | grep -q "^[[:space:]]*[ðŸ›âœ¨ðŸ“šðŸ’„â™»ï¸âš¡ðŸ§ªðŸ”§ðŸ‘·ðŸ—ï¸âªðŸš¨ðŸ”’ðŸš§ðŸ”€]"; then
        echo "$message"
        return
    fi
    
    # å„ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«å¯¾å¿œã™ã‚‹çµµæ–‡å­—ã‚’è¿½åŠ 
    case "$message" in
        "fix:"*)
            echo "ðŸ› $message"
            ;;
        "bug:"*)
            echo "ðŸ› $message"
            ;;
        "feat:"*)
            echo "âœ¨ $message"
            ;;
        "feature:"*)
            echo "âœ¨ $message"
            ;;
        "docs:"*)
            echo "ðŸ“š $message"
            ;;
        "style:"*)
            echo "ðŸ’„ $message"
            ;;
        "refactor:"*)
            echo "â™»ï¸ $message"
            ;;
        "perf:"*)
            echo "âš¡ $message"
            ;;
        "test:"*)
            echo "ðŸ§ª $message"
            ;;
        "chore:"*)
            echo "ðŸ”§ $message"
            ;;
        "ci:"*)
            echo "ðŸ‘· $message"
            ;;
        "build:"*)
            echo "ðŸ—ï¸ $message"
            ;;
        "revert:"*)
            echo "âª $message"
            ;;
        "hotfix:"*)
            echo "ðŸš¨ $message"
            ;;
        "security:"*)
            echo "ðŸ”’ $message"
            ;;
        "wip:"*)
            echo "ðŸš§ $message"
            ;;
        "merge:"*)
            echo "ðŸ”€ $message"
            ;;
        *)
            # ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒãƒžãƒƒãƒã—ãªã„å ´åˆã¯ãã®ã¾ã¾è¿”ã™
            echo "$message"
            ;;
    esac
}

# çµµæ–‡å­—ã‚’è¿½åŠ ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
new_commit_msg=$(add_emoji "$commit_msg")

# æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãæˆ»ã™
echo "$new_commit_msg" > "$commit_msg_file"

exit 0
